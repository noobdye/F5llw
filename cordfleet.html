<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>CordFleet - Painel de Bots</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }
    header {
      width: 100%;
      max-width: 720px;
      text-align: center;
      margin-bottom: 30px;
    }
    header h1 {
      font-weight: 700;
      font-size: 2rem;
      color: #5865f2;
      letter-spacing: 2px;
    }
    .container {
      max-width: 720px;
      width: 100%;
      background: #1e1e1e;
      border-radius: 12px;
      padding: 30px 30px 40px;
      box-shadow: 0 8px 20px rgb(88 101 242 / 0.5);
    }
    input[type="file"] {
      margin-top: 12px;
      width: 100%;
      padding: 14px 12px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background: #2e2e2e;
      color: #eee;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    input[type="file"]:hover {
      background: #444;
    }
    button {
      margin-top: 16px;
      width: 100%;
      padding: 14px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      background: #5865f2;
      color: white;
      cursor: pointer;
      transition: background-color 0.25s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    button:disabled {
      background: #3b3b7a;
      cursor: not-allowed;
    }
    #botStatus {
      margin-top: 25px;
      background: #2c2c2c;
      border-radius: 10px;
      padding: 20px;
      font-size: 1rem;
      color: #ddd;
      box-shadow: inset 0 0 10px #0009;
    }
    #botStatus hr {
      border: none;
      border-top: 1px solid #444;
      margin: 12px 0;
    }
    #botStatus p {
      margin: 6px 0;
    }
    #botStatus .actions button {
      width: auto;
      margin: 8px 6px 0 0;
      padding: 8px 14px;
      font-size: 0.9rem;
    }
    #status {
      font-size: 1.15rem;
      text-align: center;
      margin-bottom: 16px;
      color: #999;
    }
    .message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      text-align: center;
    }
    .message.success {
      background: #2a7a2a;
      color: #d2f8d2;
    }
    .message.error {
      background: #a63535;
      color: #f8d2d2;
    }
    .loading-spinner {
      border: 3px solid #ddd;
      border-top: 3px solid #5865f2;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% {transform: rotate(0deg);}
      100% {transform: rotate(360deg);}
    }
  </style>
</head>
<body>
  <header>
    <h1>CordFleet - Painel de Bots</h1>
  </header>
  <div class="container" id="app">
    <div id="status">Verificando login...</div>
  </div>

  <script>
    const discloudToken = "eyJhbGciOiJIUzI1NiJ9.eyJpZCI6IjEwOTg3NDUzODQ4NDg4NTkyNTgiLCJrZXkiOiJhYzRmYTIzZGVjZGFkMjE3ODZlNzY3ZjNiYTk0In0.MPy6WoCQRlts4bHoVRLYyb8gqw9m6eRu3CuQFv7u_JY";
    const clientId = "1358987708579709042";
    const clientSecret = "FZQWyJTmpGgBSpCfTBRd1kcGl6Xf7-XI";
    const redirectUri = "https://www.f5llw.shop/cordfleet.html";

    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");

    const app = document.getElementById("app");
    const statusEl = document.getElementById("status");

    let userId = null;
    let lastStatusTime = null;

    function showMessage(type, text) {
      const msgDiv = document.createElement("div");
      msgDiv.className = `message ${type}`;
      msgDiv.textContent = text;
      app.insertBefore(msgDiv, app.firstChild);
      setTimeout(() => {
        msgDiv.remove();
      }, 5000);
    }

    function setButtonLoading(button, isLoading) {
      if (isLoading) {
        button.disabled = true;
        button.innerHTML = `<div class="loading-spinner"></div>`;
      } else {
        button.disabled = false;
        button.textContent = button.getAttribute("data-text");
      }
    }

    function renderPainel() {
      app.innerHTML = `
        <h2>Ol√°, usu√°rio #${userId}</h2>
        <p>Envie seu bot (.zip) para hospedar (1 bot por pessoa)</p>
        <input type="file" id="zipFile" accept=".zip" />
        <button id="uploadBtn" data-text="Hospedar Bot">üöÄ Hospedar Bot</button>
        <button id="refreshBtn" data-text="Atualizar Status">üîÑ Atualizar Status</button>
        <div id="botStatus"></div>
      `;

      document.getElementById("uploadBtn").addEventListener("click", uploadBot);
      document.getElementById("refreshBtn").addEventListener("click", () => {
        checkUserBot(true);
      });
      checkUserBot();
    }

    function checkUserBot(showLoading = false) {
      if (showLoading) {
        const refreshBtn = document.getElementById("refreshBtn");
        setButtonLoading(refreshBtn, true);
      }
      axios.get("https://api.discloud.app/v1/bot", {
        headers: { Authorization: `Bearer ${discloudToken}` },
      })
        .then(({ data }) => {
          const apps = data.filter((app) => app.userID === userId);
          if (apps.length > 0) {
            const bot = apps[0];
            lastStatusTime = new Date().toLocaleString();
            document.getElementById("botStatus").innerHTML = `
              <hr />
              <p><strong>Seu Bot:</strong> ${bot.name}</p>
              <p>Status: <strong>${bot.status}</strong></p>
              <p>RAM usada: ${bot.ramUsed} MB</p>
              <p>CPU: ${bot.cpuPercent || 'N/A'}</p>
              <p>Disco: ${bot.diskUsed || 'N/A'}</p>
              <p>Data de cria√ß√£o: ${bot.createdAt ? new Date(bot.createdAt).toLocaleString() : 'N/A'}</p>
              <p><em>√öltima atualiza√ß√£o: ${lastStatusTime}</em></p>
              <div class="actions">
                <button id="logsBtn" data-text="Ver Logs">üìú Ver Logs</button>
                <button id="restartBtn" data-text="Reiniciar">üîÑ Reiniciar</button>
                <button id="removeBtn" data-text="Remover">üóëÔ∏è Remover</button>
              </div>
            `;

            document.getElementById("logsBtn").addEventListener("click", () => verLogs(bot.id));
            document.getElementById("restartBtn").addEventListener("click", () => reiniciarBot(bot.id));
            document.getElementById("removeBtn").addEventListener("click", () => removerBot(bot.id));
          } else {
            document.getElementById("botStatus").innerHTML = `<p>Voc√™ n√£o tem bots hospedados.</p>`;
          }
        })
        .catch((err) => {
          showMessage("error", "Erro ao carregar bots: " + (err.response?.data?.message || err.message));
        })
        .finally(() => {
          if (showLoading) {
            setButtonLoading(document.getElementById("refreshBtn"), false);
          }
        });
    }

    function uploadBot() {
      const file = document.getElementById("zipFile").files[0];
      if (!file) return showMessage("error", "Envie um arquivo ZIP!");

      const uploadBtn = document.getElementById("uploadBtn");
      setButtonLoading(uploadBtn, true);

      const formData = new FormData();
      formData.append("file", file);

      axios
        .post("https://api.discloud.app/v1/bot", formData, {
          headers: {
            Authorization: `Bearer ${discloudToken}`,
            "Content-Type": "multipart/form-data",
          },
        })
        .then(() => {
          showMessage("success", "Bot hospedado com sucesso!");
          checkUserBot();
          document.getElementById("zipFile").value = "";
        })
        .catch((err) => {
          showMessage("error", "Erro ao hospedar: " + (err.response?.data?.message || err.message));
        })
        .finally(() => {
          setButtonLoading(uploadBtn, false);
        });
    }

    function verLogs(appId) {
      axios
        .get(`https://api.discloud.app/v1/bot/${appId}/logs`, {
          headers: { Authorization: `Bearer ${discloudToken}` },
        })
        .then(({ data }) => {
          alert("Logs:\n" + data.logs);
        })
        .catch((err) => {
          showMessage("error", "Erro ao buscar logs: " + (err.response?.data?.message || err.message));
        });
    }

    function reiniciarBot(appId) {
      const restartBtn = document.getElementById("restartBtn");
      setButtonLoading(restartBtn, true);
      axios
        .post(`https://api.discloud.app/v1/bot/${appId}/restart`, {}, {
          headers: { Authorization: `Bearer ${discloudToken}` },
        })
        .then(() => {
          showMessage("success", "Bot reiniciado.");
          checkUserBot();
        })
        .catch((err) => showMessage("error", "Erro ao reiniciar: " + (err.response?.data?.message || err.message)))
        .finally(() => {
          setButtonLoading(restartBtn, false);
        });
    }

    function removerBot(appId) {
      const removeBtn = document.getElementById("removeBtn");
      if (!confirm("Tem certeza que deseja remover seu bot? Esta a√ß√£o √© irrevers√≠vel.")) return;

      setButtonLoading(removeBtn, true);
      axios
        .delete(`https://api.discloud.app/v1/bot/${appId}`, {
          headers: { Authorization: `Bearer ${discloudToken}` },
        })
        .then(() => {
          showMessage("success", "Bot removido com sucesso.");
          checkUserBot();
        })
        .catch((err) => showMessage("error", "Erro ao remover: " + (err.response?.data?.message || err.message)))
        .finally(() => {
          setButtonLoading(removeBtn, false);
        });
    }

    function discordLogin() {
      const params = new URLSearchParams({
        client_id: clientId,
        redirect_uri: redirectUri,
        response_type: "code",
        scope: "identify",
      });
      window.location.href = `https://discord.com/api/oauth2/authorize?${params.toString()}`;
    }

    async function fetchAccessToken(code) {
      const params = new URLSearchParams({
        client_id: clientId,
        client_secret: clientSecret,
        grant_type: "authorization_code",
        code,
        redirect_uri: redirectUri,
        scope: "identify",
      });

      const response = await axios.post("https://discord.com/api/oauth2/token", params, {
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
      });
      return response.data.access_token;
    }

    async function fetchUser(accessToken) {
      const response = await axios.get("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${accessToken}` },
      });
      return response.data;
    }

    async function main() {
      if (!code) {
        statusEl.textContent = "Redirecionando para login...";
        discordLogin();
        return;
      }

      try {
        statusEl.textContent = "Autenticando...";
        const accessToken = await fetchAccessToken(code);
        const user = await fetchUser(accessToken);
        userId = user.id;
        renderPainel();
      } catch (e) {
        statusEl.textContent = "Erro ao autenticar, tente recarregar a p√°gina.";
        console.error(e);
      }
    }

    main();
  </script>
</body>
</html>
